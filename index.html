<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <title>Nedtelling til Eksamen</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1>ðŸ“š Nedtelling til Eksamen</h1>
  <div id="exams"></div>

  <script>
    const exams = [
      { subject: "ðŸ—³ï¸ INF115", date: "2025-05-13T09:00:00" },
      { subject: "ðŸ‘¾ INF101", date: "2025-05-19T09:00:00" },
      { subject: "ðŸ‘©ðŸ¼â€ðŸ’» INF222", date: "2025-05-22T09:00:00" },
      { subject: "ðŸŽ² MNF130", date: "2025-05-27T09:00:00" }
    ];

    const emojis = ["ðŸ˜°", "ðŸ˜…", "ðŸ˜Ž", "ðŸ¤“", "ðŸ˜´", "ðŸ’ª", "ðŸ”¥"];
    let emojiStatus = JSON.parse(localStorage.getItem("emojiStatus") || "{}");

    function saveStatus() {
      localStorage.setItem("emojiStatus", JSON.stringify(emojiStatus));
    }

    function renderExams() {
      const container = document.getElementById("exams");
      container.innerHTML = "";

      exams.forEach((exam, index) => {
        const examDate = new Date(exam.date);
        const now = new Date();
        const diff = examDate - now;

        const wrapper = document.createElement("div");
        wrapper.className = "exam";

        const subject = document.createElement("div");
        subject.className = "subject";
        subject.textContent = exam.subject;

        const countdown = document.createElement("div");
        countdown.className = "countdown";
        countdown.id = `countdown-${index}`;

        countdown.textContent = diff <= 0 ? "Ferdig! ðŸŽ‰" : formatTime(diff);

        const emoji = document.createElement("div");
        emoji.className = "emoji";
        emoji.textContent = emojiStatus[exam.subject] || "âž•";

        const picker = document.createElement("div");
        picker.className = "emoji-picker";

        emojis.forEach(em => {
          const span = document.createElement("span");
          span.textContent = em;
          span.onclick = () => {
            emojiStatus[exam.subject] = em;
            saveStatus();
            renderExams();
          };
          picker.appendChild(span);
        });

        // Trykk og hold pÃ¥ boksen for emojivalg (touch)
        let pressTimer;
        const startHold = () => {
          pressTimer = setTimeout(() => {
            wrapper.classList.add("zoomed");
            picker.style.display = "block";
          }, 500);
        };

        const cancelHold = () => {
          clearTimeout(pressTimer);
          wrapper.classList.remove("zoomed");
          picker.style.display = "none";
        };

        wrapper.addEventListener("mousedown", startHold);
        wrapper.addEventListener("mouseup", cancelHold);
        wrapper.addEventListener("mouseleave", cancelHold);

        wrapper.addEventListener("touchstart", startHold);
        wrapper.addEventListener("touchend", cancelHold);
        wrapper.addEventListener("touchcancel", cancelHold);

        wrapper.appendChild(subject);
        wrapper.appendChild(countdown);
        wrapper.appendChild(emoji);
        wrapper.appendChild(picker);
        container.appendChild(wrapper);
      });
    }

    function formatTime(ms) {
      const days = Math.floor(ms / (1000 * 60 * 60 * 24));
      const hours = Math.floor((ms / (1000 * 60 * 60)) % 24);
      const minutes = Math.floor((ms / (1000 * 60)) % 60);
      const seconds = Math.floor((ms / 1000) % 60);
      return `${days} dager ${hours}t ${minutes}m ${seconds}s igjen`;
    }

    function updateTimers() {
      exams.forEach((exam, i) => {
        const countdown = document.getElementById(`countdown-${i}`);
        if (countdown) {
          const diff = new Date(exam.date) - new Date();
          countdown.textContent = diff <= 0 ? "Ferdig! ðŸŽ‰" : formatTime(diff);
        }
      });
    }

    renderExams();
    setInterval(updateTimers, 1000);
  </script>
</body>
</html>
